{"version":3,"sources":["../src/datasource.js"],"names":["_","axios","GenericDatasource","instanceSettings","$q","backendSrv","templateSrv","geolocationv","i","a","UnixTimestamp","Date","getTime","Math","random","b","bp","split","Number","floor","sv","push","type","url","name","q","withCredentials","headers","basicAuth","length","console","log","jsonData","appiot","appiotaccesstoken","appiotdevicenetwork","resourceList","getAllResourceUrlFromDevice","then","result","catch","err","rweflag","deviceidentifier","objecttypeid","Promise","resolve","reject","apiURI","get","apiHeaders","data","Rows","Id","promiseArray","SmartObjects","forEach","obj","TypeId","promise","all","spread","args","resource","AccessType","error","message","lat","lon","precision","Geohash","base32","decode","geohash","bounds","latMin","sw","lonMin","latMax","ne","lonMax","toFixed","LN10","p","hash","GeohashEncode","posn","isNaN","Error","idx","bit","evenBit","lonMid","latMid","charAt","options","query","buildQueryParameters","targets","filter","t","hide","when","caller","req","target","find","Name","from","range","to","tsResultArray","tsResult","config","targettype","columns","col1","text","sort","desc","col2","col3","col4","col5","rows","v","value","part","row","geoh","toISOString","col","bv","datapoints","arr","val","status","title","calleroption","eventcategoryname","annotation","event","time","CreatedDateTime","EventCategoryName","ann","enabled","datasource","showLine","RuleName","ResetDateTime","tags","list","mapToTextValue","map","d","isObject","datasourceRequest","replace","scopedVars","refId"],"mappings":"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","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\nimport * as axios from \"./node_modules/axios/dist/axios\";\n\n\nexport class GenericDatasource {\n\n\n\n  constructor(instanceSettings, $q, backendSrv, templateSrv) {\n    this.geolocationv = []\n    for (var i = 0; i < 50; i++) {\n      var a = {}\n      a.UnixTimestamp = (new Date().getTime()) - Math.random() * 600000;\n      var b = '22.288702,114.211625,30'\n      var bp = b.split(',')\n      bp[0] = Number(bp[0]) - Math.random() * 0.002\n      bp[1] = Number(bp[1]) - Math.random() * 0.003\n      bp[2] = Math.floor(Number(bp[2]) + Math.random() * 20)\n      a.sv = bp[0] + ',' + bp[1] + ',' + bp[2]\n      this.geolocationv.push(a)\n    }\n    this.type = instanceSettings.type;\n    this.url = instanceSettings.url;\n    this.name = instanceSettings.name;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.withCredentials = instanceSettings.withCredentials;\n    this.headers = { 'Content-Type': 'application/json' };\n    if (typeof instanceSettings.basicAuth === 'string' && instanceSettings.basicAuth.length > 0) {\n      this.headers['Authorization'] = instanceSettings.basicAuth;\n    }\n    console.log(instanceSettings.jsonData)\n    this.appiot = {\n      //'apiURI': 'https://iotabusinesslab-api.sensbysigma.com/api/v3',\n      'apiURI': instanceSettings.url,\n      'apiHeaders': {\n        'Authorization': instanceSettings.jsonData.appiotaccesstoken,\n        'X-DeviceNetwork': instanceSettings.jsonData.appiotdevicenetwork,\n        //'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkbklkIjoiMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwIiwicGVybWlzc2lvbnMiOm51bGwsImlzcyI6ImFwcGlvdHdlYmFwaSIsImF1ZCI6ImFwcGlvdHdlYmFwaSIsImV4cCI6MTUxNTkzMzM1MywibmJmIjoxNTA4NTA4OTEwLCJpYXQiOjE1MDg1MDg5MTAsIm5hbWUiOiJCTEFCSEsiLCJ0b2tlblR5cGUiOiJhY2Nlc3NUb2tlbiIsInVzZXJJZCI6IjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCJ9.E0xhLJjh+tEO2w7Tvtx+sco6h8WlWN2nVSGHpTKkn0Q=',\n        //'X-DeviceNetwork': '613b7124-e2db-4e76-9feb-102a869bd497',\n        'Content-Type': 'application/json',\n      },\n    }\n\n    this.resourceList = null;\n    this.getAllResourceUrlFromDevice(1)\n      .then((result) => {\n        this.resourceList = result;\n        /*var resource = this.resourceList.find(resource => {\n          return resource.Name == \"BleSensor\"\n        })*/\n        console.log(this.resourceList.length)\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n\n  }\n\n\n  getAllResourceUrlFromDevice(rweflag) { // objecttypeid is the lwm2m object id in the resourceurl e.g. 3303      \n    const deviceidentifier = this.name.split(\"/\")[0]\n    const objecttypeid = this.name.split(\"/\")[1]\n    const appiot = this.appiot\n    return new Promise(function (resolve, reject) {\n      let url = `${appiot.apiURI}/devices?filter[0].Key=deviceidentifier&filter[0].Value=${deviceidentifier}`\n      axios.get(url, { 'headers': appiot.apiHeaders })\n        .then((result) => {\n          if (result.data.Rows.length > 0) {\n            let resourceList = [];\n            let url = `${appiot.apiURI}/devices/${result.data.Rows[0].Id}`;\n            axios.get(url, { 'headers': appiot.apiHeaders })\n              .then((result) => {\n                let promiseArray = [];\n                result.data.SmartObjects.forEach((obj) => {\n                  if (obj.TypeId == objecttypeid) {\n                    url = `${appiot.apiURI}/resources?filter[0].Key=smartobjectid&filter[0].Value=${obj.Id}`;\n                    let promise = axios.get(url, { 'headers': appiot.apiHeaders })\n                    promiseArray.push(promise)\n                  }\n                })\n                if (promiseArray.length == 0) {\n                  reject(`Cannot found matching object type id?: ${objecttypeid}`);\n                }\n                // perform concurrent get calls for all smart objects                       \n                axios.all(promiseArray)\n                  .then(axios.spread((...args) => {\n                    for (let i = 0; i < args.length; i++) {\n                      args[i].data.Rows.forEach((resource) => { // resource obj\n                        if ((resource.AccessType & rweflag) > 0) { // required bitand with flag\n                          resourceList.push(resource)\n                        }\n                      })\n                    }\n                    if (resourceList.length == 0) {\n                      reject(`Cannot found matching AccessType?: ${rweflag}`);\n                    }\n                    resolve(resourceList)\n                  }))\n                  .catch((error) => {\n                    console.log(error);\n                    reject(`error getting /resources?: ${error.message}`);\n                  })\n              })\n              .catch((error) => {\n                console.log(error);\n                reject(`error getting /devices/id: ${error.message}`);\n              })\n          } else {\n            reject(`deviceidentifier not found: ${error.message}`);\n          }\n        })\n        .catch((error) => {\n          console.log(error);\n          reject(`error getting deviceidentifier: ${error.message}`);\n        })\n    })\n  }\n\n\n\n  GeohashEncode(lat, lon, precision) {\n    var Geohash = {};\n    /* (Geohash-specific) Base32 map */\n    Geohash.base32 = '0123456789bcdefghjkmnpqrstuvwxyz';\n    Geohash.decode = function (geohash) {\n\n      var bounds = Geohash.bounds(geohash); // <-- the hard work\n      // now just determine the centre of the cell...\n\n      var latMin = bounds.sw.lat, lonMin = bounds.sw.lon;\n      var latMax = bounds.ne.lat, lonMax = bounds.ne.lon;\n\n      // cell centre\n      var lat = (latMin + latMax) / 2;\n      var lon = (lonMin + lonMax) / 2;\n\n      // round to close to centre without excessive precision: ⌊2-log10(Δ°)⌋ decimal places\n      lat = lat.toFixed(Math.floor(2 - Math.log(latMax - latMin) / Math.LN10));\n      lon = lon.toFixed(Math.floor(2 - Math.log(lonMax - lonMin) / Math.LN10));\n\n      return { lat: Number(lat), lon: Number(lon) };\n    };\n\n    // infer precision?\n    if (typeof precision == 'undefined') {\n      // refine geohash until it matches precision of supplied lat/lon\n      for (var p = 1; p <= 12; p++) {\n        var hash = this.GeohashEncode(lat, lon, p);\n        var posn = Geohash.decode(hash);\n        if (posn.lat == lat && posn.lon == lon) return hash;\n      }\n      precision = 12; // set to maximum\n    }\n\n    lat = Number(lat);\n    lon = Number(lon);\n    precision = Number(precision);\n\n    if (isNaN(lat) || isNaN(lon) || isNaN(precision)) throw new Error('Invalid geohash');\n\n    var idx = 0; // index into base32 map\n    var bit = 0; // each char holds 5 bits\n    var evenBit = true;\n    var geohash = '';\n\n    var latMin = -90, latMax = 90;\n    var lonMin = -180, lonMax = 180;\n\n    while (geohash.length < precision) {\n      if (evenBit) {\n        // bisect E-W longitude\n        var lonMid = (lonMin + lonMax) / 2;\n        if (lon >= lonMid) {\n          idx = idx * 2 + 1;\n          lonMin = lonMid;\n        } else {\n          idx = idx * 2;\n          lonMax = lonMid;\n        }\n      } else {\n        // bisect N-S latitude\n        var latMid = (latMin + latMax) / 2;\n        if (lat >= latMid) {\n          idx = idx * 2 + 1;\n          latMin = latMid;\n        } else {\n          idx = idx * 2;\n          latMax = latMid;\n        }\n      }\n      evenBit = !evenBit;\n\n      if (++bit == 5) {\n        // 5 bits gives us a character: append it and start over\n        geohash += Geohash.base32.charAt(idx);\n        bit = 0;\n        idx = 0;\n      }\n    }\n\n    return geohash;\n  };\n\n  query(options) {\n    var query = this.buildQueryParameters(options);\n    query.targets = query.targets.filter(t => !t.hide);\n\n    if (query.targets.length <= 0) {\n      return this.q.when({ data: [] });\n    }\n\n    /*return this.doRequest({\n      url: this.url + '/query',\n      data: query,\n      method: 'POST'\n    });*/\n    const caller = this\n    const req = query\n    return new Promise(function (resolve, reject) {\n\n      let promiseArray = [];\n      req.targets.forEach((target) => {\n        var resource = caller.resourceList.find(resource => {\n          return resource.Name == target.target\n        })\n        var from = new Date(req.range.from).getTime();\n        var to = new Date(req.range.to).getTime();\n        var url = `${caller.appiot.apiURI}/measurements/${resource.Id}/since/${from}/to/${to}`;\n        let promise = axios.get(url, { 'headers': caller.appiot.apiHeaders, 'target': target.target, 'targettype': target.type }).catch((err) => { console.log(err) })\n        promiseArray.push(promise)\n      })\n      var tsResultArray = [];\n      // perform concurrent get calls for all smart objects                       \n      axios.all(promiseArray)\n        .then(axios.spread((...args) => {\n          for (let i = 0; i < args.length; i++) {\n            var tsResult = {}\n            if (args[i] == null) {\n              continue;\n            }\n\n            if (args[i].config.targettype == 'table') {\n              if (args[i].config.target == 'GeoLocation') {\n                tsResult.columns = []\n                var col1 = {}\n                col1.text = 'Time'\n                col1.type = 'time'\n                col1.sort = true,\n                  col1.desc = true,\n                  tsResult.columns.push(col1)\n                var col2 = {}\n                col2.text = 'sv'\n                col2.type = 'string'\n                tsResult.columns.push(col2)\n                var col3 = {}\n                col3.text = 'metric'\n                col3.type = 'string'\n                tsResult.columns.push(col3)\n                var col4 = {}\n                col4.text = 'geohash'\n                col4.type = 'string'\n                tsResult.columns.push(col4)\n                var col5 = {}\n                col5.text = 'timestr'\n                col5.type = 'string'\n                tsResult.columns.push(col5)\n                tsResult.rows = []\n                tsResult.type = 'table'\n              \n                args[i].data.v.forEach((value) => { // resource obj\n\n                //caller.geolocationv.forEach((value) => { // resource obj\n                  var part = value.sv.split(\",\")\n                  if (part.length <3) {\n                    \n                  }\n                  else {\n                    var row = []\n                    row.push(value.UnixTimestamp)\n                    row.push(value.sv)                  \n                    row.push(part[2])\n                    var lat = Number(part[0]) - Math.random() * 0.002\n                    var lon = Number(part[1]) - Math.random() * 0.003\n                    var geoh = caller.GeohashEncode(lat,lon,9)\n                    row.push(geoh)\n                    row.push(new Date(value.UnixTimestamp).toISOString())\n                    tsResult.rows.push(row)\n                  }\n                })\n              }\n              else {\n                tsResult.columns = []\n                var col1 = {}\n                col1.text = 'Time'\n                col1.type = 'time'\n                col1.sort = true,\n                  col1.desc = true,\n                  tsResult.columns.push(col1)\n                var col = {}\n                col.text = 'v'\n                col.type = 'number'\n                tsResult.columns.push(col)\n                col.text = 'sv'\n                col.type = 'string'\n                tsResult.columns.push(col)\n                col.text = 'bv'\n                col.type = 'boolean'\n                tsResult.columns.push(col)\n                tsResult.rows = []\n                tsResult.type = 'table'\n                args[i].data.v.forEach((value) => { // resource obj\n                  var row = []\n                  row.push(value.UnixTimestamp)\n                  row.push(value.v)\n                  row.push(value.sv)\n                  row.push(value.bv)\n                  tsResult.rows.push(row)\n                })\n              }\n            }\n            else {\n              tsResult.target = args[i].config.target\n              tsResult.datapoints = []\n              args[i].data.v.forEach((value) => { // resource obj\n                var arr = []\n                var val = 0\n                if (value.v != null) {\n                  val = value.v\n                }\n                else if (value.sv != null) {\n                  val = value.sv\n                }\n                arr.push(val)\n                arr.push(value.UnixTimestamp)\n                tsResult.datapoints.push(arr)\n              })\n            }\n            tsResultArray.push(tsResult)\n          }\n          var result = {}\n          result.data = tsResultArray\n          resolve(result);\n\n        }))\n        .catch((error) => {\n          console.log(error);\n          reject(error)\n        })\n    })\n  }\n\n  testDatasource() {\n    const caller = this\n    return new Promise(function (resolve, reject) {\n      caller.getAllResourceUrlFromDevice(1)\n        .then((result) => {\n          caller.resourceList = result;\n          resolve({ status: \"success\", message: \"AppIoT data source is working. Connected with \" + caller.resourceList.length + \" resources.\", title: \"Success\" })\n        })\n        .catch((err) => {\n          console.log(err)\n          reject(err)\n        })\n    })\n\n\n    /*return this.doRequest({\n      url: this.url + '/',\n      method: 'GET',\n    }).then(response => {\n      if (response.status === 200) {\n        return { status: \"success\", message: \"Data source is working\", title: \"Success\" };\n      }\n    });*/\n  }\n\n  annotationQuery(options) {\n    const calleroption = options\n    const caller = this\n    return new Promise(function (resolve, reject) {\n      var eventcategoryname = calleroption.annotation.query //\"BLABHK_IoTServiceApp_Alert\" // need to put this to the configuration menu\n      let url = `${caller.appiot.apiURI}/events?filter[0].Key=EventCategoryName&filter[0].Value=${eventcategoryname}`\n      axios.get(url, { 'headers':caller.appiot.apiHeaders }) // todo get pagination\n        .then((result) => {\n          var arr = []\n          result.data.Rows.forEach((event)=>{\n            var time = new Date(event.CreatedDateTime).getTime()\n            var from = new Date(calleroption.range.from).getTime()\n            var to = new Date(calleroption.range.to).getTime()\n            if (time <= to && time >= from && event.EventCategoryName ==  calleroption.annotation.query) {\n              var ann = {}\n              ann.name = eventcategoryname\n              ann.enabled = true\n              ann.datasource = 'appiot datasource'\n              ann.showLine = true\n              var annotation = {}\n              annotation.annotation = calleroption.annotation\n              annotation.title = event.RuleName\n              annotation.time = time\n              annotation.text = 'created:' + event.CreatedDateTime + 'reset:' + event.ResetDateTime\n              annotation.tags = calleroption.annotation.query\n              arr.push(annotation)\n            }\n          })\n          resolve(arr)\n        })\n        .catch((err)=>{\n          console.log(err)\n          reject(err)\n        })\n      })\n          \n\n    /*var query = this.templateSrv.replace(options.annotation.query, {}, 'glob');\n    var annotationQuery = {\n      range: options.range,\n      annotation: {\n        name: options.annotation.name,\n        datasource: options.annotation.datasource,\n        enable: options.annotation.enable,\n        iconColor: options.annotation.iconColor,\n        query: query\n      },\n      rangeRaw: options.rangeRaw\n    };\n\n    return this.doRequest({\n      url: this.url + '/annotations',\n      method: 'POST',\n      data: annotationQuery\n    }).then(result => {\n      return result.data;\n    });\n    return [];*/\n  }\n\n  metricFindQuery(query) {\n    /* var interpolated = {\n         target: this.templateSrv.replace(query, null, 'regex')\n     };\n \n     return this.doRequest({\n       url: this.url + '/search',\n       data: interpolated,\n       method: 'POST',\n     }).then(this.mapToTextValue);*/\n\n       // generate random geolocation data\n       \n    const caller = this\n    console.log('here metricFindQuery')\n    return new Promise(function (resolve, reject) {\n      caller.getAllResourceUrlFromDevice(1)\n        .then((result) => {\n          caller.resourceList = result;\n          var list = []\n          caller.resourceList.forEach((resource) => {\n            list.push(resource.Name)\n          })\n          var result = {}\n          result.data = list\n          resolve(caller.mapToTextValue(result))\n        })\n        .catch((err) => {\n          console.log(err)\n          reject(err)\n        })\n\n    })\n\n  }\n\n  mapToTextValue(result) {\n    return _.map(result.data, (d, i) => {\n      if (d && d.text && d.value) {\n        return { text: d.text, value: d.value };\n      } else if (_.isObject(d)) {\n        return { text: d, value: i };\n      }\n      return { text: d, value: d };\n    });\n  }\n\n  doRequest(options) {\n    options.withCredentials = this.withCredentials;\n    options.headers = this.headers;\n\n    return this.backendSrv.datasourceRequest(options);\n  }\n\n  buildQueryParameters(options) {\n    //remove placeholder targets\n    options.targets = _.filter(options.targets, target => {\n      return target.target !== 'select metric';\n    });\n\n    var targets = _.map(options.targets, target => {\n      return {\n        target: this.templateSrv.replace(target.target, options.scopedVars, 'regex'),\n        refId: target.refId,\n        hide: target.hide,\n        type: target.type || 'timeserie'\n      };\n    });\n\n    options.targets = targets;\n\n    return options;\n  }\n}\n"]}